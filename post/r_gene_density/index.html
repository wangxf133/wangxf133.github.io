<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>R_Gene_density | xiaofei</title>
<link rel="shortcut icon" href="https://wangxf133.github.io/favicon.ico">
<link rel="stylesheet" href="https://wangxf133.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://wangxf133.github.io">
  <img class="avatar" src="https://wangxf133.github.io/images/avatar.png" alt="" width="80px" height="80px">
  </a>
  <h1 class="site-title">
    xiaofei
  </h1>
  <p class="site-description">
    东北师范大学-老博士一枚
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
</div>

      
        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              R_Gene_density
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2019-03-27 ·
              </time>
              
                <a href="https://wangxf133.github.io/tag/p2fMPam8D" class="post-tags">
                  # 画图
                </a>
              
                <a href="https://wangxf133.github.io/tag/uyiySPsgI" class="post-tags">
                  # Gene_density
                </a>
              
                <a href="https://wangxf133.github.io/tag/m29Zf0LCY" class="post-tags">
                  # R系列
                </a>
              
            </div>
            <div class="post-content">
              <!--more-->
<h1 id="基因密度热图">基因密度热图</h1><h3 id="1.数据准备">1.数据准备</h3><p>两个文件<br>一个是基因长度文件(Osativa_gene-length.txt)<br><img src="https://ws1.sinaimg.cn/large/734cbfa0ly1fr1ys98954j20gk0oldi7.jpg" alt="基因长度"><br>另一个是染色体信息(Osativa_323_v7.0.fa.seqlengths.txt)<br><img src="https://ws1.sinaimg.cn/large/734cbfa0ly1fr1ytrm6mhj20ct08kmxq.jpg" alt="染色体信息"></p>
<h3 id="2.r中的包进行安装">2.R中的包进行安装</h3><p>2.1 在RStudio中更新R的版本(要求在Gui中更新比较好)</p>
<pre><code class="language-R">    install.packages(&quot;installr&quot;)
    install.packages(&quot;stringi&quot;)
    library(&quot;stringi&quot;)
    library(&quot;installr&quot;)
    installr()</code></pre>
<p>2.2 各种包的安装</p>
<pre><code class="language-R">source(&quot;http://bioconductor.org/biocLite.R&quot;)
biocLite(&quot;gtrellis&quot;)
library(&quot;gtrellis&quot;)

install.packages(&quot;RColorBrewer&quot;)
library(&quot;RColorBrewer&quot;)

install.packages(&quot;circlize&quot;)
library(&quot;circlize&quot;)


source(&quot;https://bioconductor.org/biocLite.R&quot;)
biocLite(&quot;ComplexHeatmap&quot;)
library(&quot;ComplexHeatmap&quot;)</code></pre>
<h3 id="3.设置工作区间及读取数据">3.设置工作区间及读取数据</h3><pre><code class="language-R">setwd(&quot;D:/R_lianxi/00.Gene_density&quot;)
bed1&lt;-read.table(&quot;Osativa_323_v7.0.fa.seqlengths.txt&quot;,head=T,sep=&#39;\t&#39;)
bed2&lt;-read.table(&quot;Osativa_gene-length.txt&quot;,head=T,sep=&#39;\t&#39;)</code></pre>
<h3 id="4.计算基因密度">4.计算基因密度</h3><pre><code class="language-R">gene_density = genomicDensity(bed2,window.size = 1e6, n.window = NULL, overlap = TRUE)
help(genomicDensity)</code></pre>
<h3 id="5.颜色映射设置">5.颜色映射设置</h3><pre><code class="language-R">col_fun = colorRamp2(seq(0, max(gene_density[[4]]),length=11),rev(brewer.pal(11,&quot;RdYlBu&quot;)))
cm = ColorMapping(col_fun = col_fun)</code></pre>
<h3 id="6.绘图，添加图例（纵坐标的那些东西）">6.绘图，添加图例（纵坐标的那些东西）</h3><pre><code class="language-R">lgd = color_mapping_legend(cm, plot = TRUE, title = &quot;&quot;,color_bar=&quot;continuous&quot;)   ##图的标尺

bed1$chr=factor(bed1$chr,levels = c(&quot;Chr1&quot;,&quot;Chr2&quot;,&quot;Chr3&quot;,&quot;Chr4&quot;,&quot;Chr5&quot;,&quot;Chr6&quot;,&quot;Chr7&quot;,&quot;Chr8&quot;,&quot;Chr9&quot;,&quot;Chr10&quot;,&quot;Chr11&quot;,&quot;Chr12&quot;))
##排序染色体排序，我们只需要调整这一列的数据就行

gtrellis_layout(bed1,byrow = F,ncol = 1,xpadding = c(0.1, 0),gap = unit(2, &quot;mm&quot;),border = FALSE,asist_ticks=FALSE,track_axis = FALSE,legend=lgd)

add_heatmap_track(gene_density, gene_density[[4]], fill = col_fun,track=1)</code></pre>
<p><img src="https://ws1.sinaimg.cn/large/734cbfa0ly1fr2se2qovaj21hc0smmyg.jpg" alt="1"></p>
<h3 id="7.画横坐标轴线，添加标签">7.画横坐标轴线，添加标签</h3><pre><code class="language-R">add_track(track = 1, clip = FALSE, panel_fun = function(gr) {
  chr = get_cell_meta_data(&quot;name&quot;)
  if(chr == &quot;Chr12&quot;) {
    grid.lines(get_cell_meta_data(&quot;xlim&quot;), unit(c(0, 0), &quot;npc&quot;),
               default.units = &quot;native&quot;) }
  grid.text(chr,x =0.01, y = 0.38, just = c(&quot;left&quot;, &quot;bottom&quot;))
})</code></pre>
<p><img src="https://ws1.sinaimg.cn/large/734cbfa0ly1fr2shklmj5j20t90swjsp.jpg" alt="2"></p>
<h3 id="8.如果不要线，只要标签">8.如果不要线，只要标签</h3><pre><code class="language-R">add_track(track = 1, clip = FALSE, panel_fun = function(gr) {
  chr = get_cell_meta_data(&quot;name&quot;)
  grid.text(chr,x =0.01, y = 0.38, just = c(&quot;left&quot;, &quot;bottom&quot;))
})</code></pre>
<p><img src="https://ws1.sinaimg.cn/large/734cbfa0ly1fr2sizbaghj20tj0swmy9.jpg" alt="3"></p>

            </div>
          </article>
        </div>
    
        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://wangxf133.github.io/post/snakemake-de-an-zhuang-ji-shi-yong">
              <h3 class="post-title">
                snakemake的安装及使用
              </h3>
            </a>
          </div>  
        

        
    
        <div class="site-footer">
  Powered by Hve Notes
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
